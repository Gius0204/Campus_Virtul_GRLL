@{
    ViewData["Title"] = "Historial de Asistencias";
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="content-card">
                <h5>Historial de Asistencias</h5>
                <hr />
                @{ var historial = (ViewBag.Historial as IEnumerable<(DateOnly fecha, TimeOnly? horaInicio, TimeOnly? horaFin, string estado, string? justificacion)>) ?? Enumerable.Empty<(DateOnly, TimeOnly?, TimeOnly?, string, string?)>(); }
                @if (!historial.Any())
                {
                    <div class="alert alert-info">No hay registros de asistencia aún.</div>
                }
                else
                {
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Horario</th>
                                <th>Estado</th>
                                <th>Justificación</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var h in historial)
                            {
                                var horario = (h.horaInicio.HasValue || h.horaFin.HasValue)
                                    ? $"{(h.horaInicio.HasValue ? h.horaInicio.Value.ToString("HH:mm") : "-")} - {(h.horaFin.HasValue ? h.horaFin.Value.ToString("HH:mm") : "-" )}"
                                    : "-";
                                <tr>
                                    <td>@h.fecha.ToString("yyyy-MM-dd")</td>
                                    <td>@horario</td>
                                    <td>
                                        @switch(h.estado)
                                        {
                                            case "presente":
                                                <span class="badge bg-success">Presente</span>
                                                break;
                                            case "tardanza":
                                                <span class="badge bg-warning">Tardanza</span>
                                                break;
                                            case "justificado":
                                                <span class="badge bg-info">Justificado</span>
                                                break;
                                            default:
                                                <span class="badge bg-danger">Ausente</span>
                                                break;
                                        }
                                    </td>
                                    <td>@(string.IsNullOrWhiteSpace(h.justificacion) ? "-" : h.justificacion)</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </div>
        </div>
    </div>
</div>
