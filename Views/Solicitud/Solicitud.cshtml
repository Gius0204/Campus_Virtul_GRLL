@model Campus_Virtul_GRLL.Models.Solicitud
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />

    <!-- Compatibilidad con navegadores antiguos -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

    <!-- Favicon para navegadores -->
    <link rel="icon" type="image/png" sizes="32x32" href="/Img/Curso.png">

    <!-- Hojas de estilo -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/Solicitud.css" asp-append-version="true" />
    <title>Solicitud</title>
</head>

<body>
    <div class="container">
        <div class="title">Solicitud</div>

        <form id="formulario" asp-action="Solicitud" asp-controller="Solicitud" method="post">
            @Html.AntiForgeryToken()

            <div class="user-details">
                <div class="input-box">
                    <span class="details">Tipo de usuario</span>
                    <select id="rol" name="IdRol" class="form-select">
                        <option value="">Seleccione un rol</option>
                        @{
                            var roles = ViewBag.Roles as IEnumerable<(Guid id, string nombre)>;
                        }
                        @if (roles != null)
                        {
                            foreach (var r in roles)
                            {
                                if (string.Equals(r.nombre, "Profesor", StringComparison.OrdinalIgnoreCase) ||
                                    string.Equals(r.nombre, "Practicante", StringComparison.OrdinalIgnoreCase))
                                {
                                    <option value="@r.id">@r.nombre</option>
                                }
                            }
                        }
                    </select>
                    <small style="color:#666; display:block; margin-top:8px;">
                        Al ser aprobada, recibirá una contraseña temporal por correo.
                        En su primer inicio se le pedirá cambiarla por una nueva.
                    </small>
                </div>
                <div class="input-box">
                    <span class="details">Nombres</span>
                    <input type="text" id="nombres" name="Nombres" placeholder="Ingrese sus nombres" maxlength="50" />
                </div>
                <div class="input-box">
                    <span class="details">Apellidos</span>
                    <input type="text" id="apellidos" name="Apellidos" placeholder="Ingrese sus apellidos" maxlength="50" />
                </div>
                <div class="input-box">
                    <span class="details">DNI</span>
                    <input type="text" id="dni" name="DNI" placeholder="Ingrese su DNI" maxlength="8" />
                </div>
                <div class="input-box">
                    <span class="details">Telefono</span>
                    <input type="text" id="telefono" name="Telefono" placeholder="Ingrese su numero telefonico" maxlength="9" pattern="\d{9}" />
                </div>
                <div class="input-box">
                    <span class="details">Correo electronico</span>
                    <input type="email" id="correElectronico" name="CorreoElectronico" placeholder="Ingrese su correo electronico" maxlength="100" />
                </div>
                <div class="input-box">
                    <span class="details">Area</span>
                    <select id="area" name="Area" class="form-select">
                        <option value="">Seleccione un área</option>
                        @{
                            var areas = ViewBag.Areas as IEnumerable<(Guid id, string nombre)>;
                        }
                        @if (areas != null)
                        {
                            foreach (var a in areas)
                            {
                                <option value="@a.id">@a.nombre</option>
                            }
                        }
                    </select>
                </div>
                @* Se eliminan los campos de contraseña según requerimiento *@
            </div>
            <div class="d-flex justify-content-between align-items-center mt-3">
                <a class="btn btn-secondary" href="@Url.Action("Index","Login")">← Volver al Login</a>
                <div class="button">
                    <input type="submit" value="Enviar" class="btn btn-primary" />
                </div>
            </div>
        </form>
    </div>

        @if (TempData["Mensaje"] != null)
        {
            <div class="mensaje-overlay"></div>
            <div class= "mensaje-externo mensaje-exito">
                <strong>✓</strong> @TempData["Mensaje"]
            </div>

            <script>
                // Redirigir al Login después de 3 segundos
                setTimeout(function() {
                    window.location.href = '@Url.Action("Index", "Login")';
                }, 3000);
            </script>
        }

        @if (TempData["Error"] != null)
        {
            <div class="mensaje-overlay" id="overlay-error"></div>
            <div class="mensaje-externo mensaje-error" id="mensaje-error">
                <strong>✗</strong> @TempData["Error"]
            </div>

            <script>
                setTimeout(function() {
                var mensaje = document.getElementById('mensaje-error');
                var overlay = document.getElementById('overlay-error');

                if (mensaje) {
                    mensaje.style.animation = 'fadeOut 20s ease';
                    setTimeout(function() {
                        mensaje.remove();
                    }, 2000);
                }

                if (overlay) {
                    overlay.style.animation = 'fadeOut 20s ease';
                    setTimeout(function() {
                        overlay.remove();
                    }, 2000);
                }
            }, 2000);

            document.getElementById('overlay-error').addEventListener('click', function() {
                var mensaje = document.getElementById('mensaje-error');
                var overlay = document.getElementById('overlay-error');

                if (mensaje) {
                    mensaje.style.animation = 'fadeOut 20s ease';
                    setTimeout(function() {
                        mensaje.remove();
                    }, 2000);
                }

                if (overlay) {
                    overlay.style.animation = 'fadeOut 20s ease';
                    setTimeout(function() {
                        overlay.remove();
                    }, 2000);
                }
            });
        </script>
        }

    <script src="~/js/Validacion_Solicitud.js" asp-append-version="true"></script>
</body>
</html>