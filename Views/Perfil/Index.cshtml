@{
    ViewData["Title"] = "Mi Perfil";
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
    var u = ((Guid id, string nombres, string? apellidos, string? dni, string? telefono, Guid? areaId, string correo, string? passwordHash, bool activo, Guid rolId, string rolNombre))ViewBag.User;
    var areas = (IEnumerable<(Guid id, string nombre)>) (ViewBag.Areas ?? Enumerable.Empty<(Guid, string)>());
}
<div class="container-fluid">
    <h1 class="page-title mb-3">Mi Perfil</h1>
    @if (TempData["Mensaje"] != null){<div class="alert alert-success">@TempData["Mensaje"]</div>}
    @if (TempData["Error"] != null){<div class="alert alert-danger">@TempData["Error"]</div>}

    <div class="row">
        <div class="col-md-6">
            <div class="content-card">
                <h5>Información</h5>
                <form method="post" asp-action="ActualizarDatos" asp-controller="Perfil">
                    @Html.AntiForgeryToken()
                    <div class="mb-2">
                        <label class="form-label">Nombres</label>
                        <input class="form-control" name="nombres" value="@u.nombres" />
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Apellidos</label>
                        <input class="form-control" name="apellidos" value="@(u.apellidos ?? "")" />
                    </div>
                    <div class="mb-2">
                        <label class="form-label">DNI</label>
                        <input class="form-control" name="dni" value="@(u.dni ?? "")" />
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Teléfono</label>
                        <input class="form-control" name="telefono" value="@(u.telefono ?? "")" />
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Correo</label>
                        <input class="form-control" value="@u.correo" disabled />
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Área</label>
                        <select class="form-select" name="areaId">
                            <option value="">-- Sin área --</option>
                            @foreach (var a in areas)
                            {
                                var selected = u.areaId.HasValue && u.areaId.Value == a.id ? "selected" : "";
                                <option value="@a.id" selected="@selected">@a.nombre</option>
                            }
                        </select>
                    </div>
                    <div class="text-end">
                        <button class="btn btn-primary" type="submit">Guardar</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="col-md-6">
            <div class="content-card">
                <h5>Contraseña</h5>
                <form method="post" asp-action="CambiarContrasena" asp-controller="Perfil">
                    @Html.AntiForgeryToken()
                    <div class="mb-2">
                        <label class="form-label">Actual</label>
                        <input class="form-control" type="password" name="actual" required />
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Nueva</label>
                        <input class="form-control" type="password" name="nueva" required minlength="8" />
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Confirmar</label>
                        <input class="form-control" type="password" name="confirmar" required minlength="8" />
                    </div>
                    <div class="text-end">
                        <button class="btn btn-secondary" type="submit">Actualizar contraseña</button>
                    </div>
                </form>
            </div>

            <div class="content-card mt-3">
                <h5>Dar de baja</h5>
                <p class="text-muted">Esto eliminará su cuenta. No se puede deshacer.</p>
                <form method="post" asp-action="DarDeBaja" asp-controller="Perfil" onsubmit="return confirm('¿Seguro que desea eliminar su cuenta?');">
                    @Html.AntiForgeryToken()
                    <button class="btn btn-danger" type="submit">Eliminar cuenta</button>
                </form>
            </div>
        </div>
    </div>
</div>